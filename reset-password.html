<!DOCTYPE html>
<html lang="en">

<head>

    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="description"
        content="furniture, home furniture, office furniture, sofas, beds, chairs, tables, wardrobes, living room furniture, bedroom furniture, dining sets, modern furniture, affordable furniture, interior decor, online furniture store, Nigeria furniture shop">
    <meta name="keywords"
        content="furniture, home furniture, office furniture, sofas, beds, chairs, tables, wardrobes, living room furniture, bedroom furniture, dining sets, modern furniture, affordable furniture, interior decor, online furniture store, Nigeria furniture shop">
    <meta name="author" content="pixelstrap">
    <link rel="icon" href="assets/images/dashboard/favicon.png" type="image/x-icon">
    <link rel="shortcut icon" href="assets/images/dashboard/favicon.png" type="image/x-icon">
    <title>Buy Quality Furniture Online | Stylish & Affordable Home Furniture | Ararat Designs</title>

    <!--Google font-->
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Work+Sans:ital,wght@0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,500;1,600;1,700;1,800;1,900&display=swap">

    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Nunito:ital,wght@0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap">


    <!-- Font Awesome-->
    <link rel="stylesheet" type="text/css" href="assets/css/vendors/font-awesome.css">

    <!-- Flag icon-->
    <link rel="stylesheet" type="text/css" href="assets/css/vendors/themify-icons.css">

    <!-- slick icon-->
    <link rel="stylesheet" type="text/css" href="assets/css/vendors/slick.css">
    <link rel="stylesheet" type="text/css" href="assets/css/vendors/slick-theme.css">

    <!-- Bootstrap css-->
    <link rel="stylesheet" type="text/css" href="assets/css/vendors/bootstrap.css">

    <!-- App css-->
    <link rel="stylesheet" type="text/css" href="assets/css/style.css">

</head>

<body>

    <!-- page-wrapper Start-->
    <div class="page-wrapper">
        <div class="authentication-box">
            <div class="container">
                <div class="row">
                    <div class="col-md-5 p-0 card-left">
                        <div class="card bg-primary mb-0">
                            <div class="single-item">
                                <div>
                                    <div class="mb-4">
                                      <h3>Welcome to Ararat Designs</h3>
                                      <p>Discover elegant, handcrafted furniture made to transform your living space. 
                                         From luxurious sofas to stylish dining sets â€” comfort meets craftsmanship here.</p>
                                    </div>
                                  </div>
                                  <div>
                                    <div class="mb-4">
                                      <h3>Upgrade Your Home with Timeless Pieces</h3>
                                      <p>Explore our premium collection of beds, wardrobes, and decor accessories. 
                                         Designed with quality materials to bring warmth and sophistication to every room.</p>
                                    </div>
                                  </div>
                                  <div>
                                    <div class="mb-4">
                                      <h3>Shop Modern Office Furniture</h3>
                                      <p>Create the perfect workspace with ergonomic chairs and sleek desks built for style and productivity. 
                                         Experience comfort that works as hard as you do.</p>
                                    </div>
                                  </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-7 p-0 card-right">
                        <div class="card tab2-card card-login mb-0">
                            <div class="card-body">
                                <div class="tab-content" id="top-tabContent">
                                    <div class="tab-pane fade show active" id="top-profile" role="tabpanel">
                                        <form class="form-horizontal reset-pass auth-form" id="resetPasswordForm">
                                            <h3 class="forgot-title">Reset Password</h3>
                                            <div id="resetPasswordMessage" class="alert d-none mb-3" role="alert"></div>
                                            
                                            <div class="form-group reset-input">
                                                <label for="password">New Password <span class="text-danger">*</span></label>
                                                <input required="" name="password" type="password"
                                                    class="form-control" placeholder="Enter new password"
                                                    id="password" minlength="6">
                                                <small class="form-text text-muted">Password must be at least 6 characters long.</small>
                                            </div>
                                            
                                            <div class="form-group reset-input">
                                                <label for="confirmPassword">Confirm Password <span class="text-danger">*</span></label>
                                                <input required="" name="confirmPassword" type="password"
                                                    class="form-control" placeholder="Confirm new password"
                                                    id="confirmPassword" minlength="6">
                                            </div>
                                            
                                            <div class="form-button">
                                                <button class="btn btn-primary" type="submit" id="resetPasswordBtn">
                                                    <span class="btn-text">Reset Password</span>
                                                    <span class="btn-loader d-none">
                                                        <span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
                                                        Resetting...
                                                    </span>
                                                </button>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <a href="login.html" class="btn btn-primary back-btn"><i data-feather="arrow-left"></i>back</a>
            </div>
        </div>
    </div>

    <!-- latest jquery-->
    <script src="assets/js/jquery-3.3.1.min.js"></script>

    <!-- Bootstrap js-->
    <script src="assets/js/bootstrap.bundle.min.js"></script>

    <!-- feather icon js-->
    <script src="assets/js/icons/feather-icon/feather.min.js"></script>
    <script src="assets/js/icons/feather-icon/feather-icon.js"></script>

    <!-- Sidebar jquery-->
    <script src="assets/js/sidebar-menu.js"></script>
    <script src="assets/js/slick.js"></script>

    <!-- lazyload js-->
    <script src="assets/js/lazysizes.min.js"></script>

    <!--right sidebar js-->
    <script src="assets/js/chat-menu.js"></script>

    <!--script admin-->
    <script src="assets/js/admin-script.js"></script>
    
    <!-- Admin App JS for API requests -->
    <script src="assets/js/admin-app.js"></script>
    
    <script>
        $('.single-item').slick({
            arrows: false,
            dots: true
        });

        // Handle reset password form submission
        (function() {
            const form = document.getElementById('resetPasswordForm');
            const passwordInput = document.getElementById('password');
            const confirmPasswordInput = document.getElementById('confirmPassword');
            const submitBtn = document.getElementById('resetPasswordBtn');
            const messageDiv = document.getElementById('resetPasswordMessage');
            
            if (!form || !passwordInput || !confirmPasswordInput || !submitBtn) return;

            // Get userId and token from URL parameters
            const urlParams = new URLSearchParams(window.location.search);
            const userId = urlParams.get('id');
            const token = urlParams.get('token');

            // Validate URL parameters
            if (!userId || !token) {
                const errorMsg = 'Invalid or missing reset link. Please request a new password reset link.';
                if (messageDiv) {
                    messageDiv.textContent = errorMsg;
                    messageDiv.className = 'alert alert-danger mb-3';
                    messageDiv.classList.remove('d-none');
                }
                form.style.display = 'none';
                
                // Redirect to forgot password page after 3 seconds
                setTimeout(() => {
                    window.location.href = 'forgot-password.html';
                }, 3000);
                return;
            }

            const showMessage = (message, type = 'success') => {
                if (messageDiv) {
                    messageDiv.textContent = message;
                    messageDiv.className = `alert alert-${type === 'success' ? 'success' : 'danger'} mb-3`;
                    messageDiv.classList.remove('d-none');
                }
                
                if (window.AdminApp && window.AdminApp.showToast) {
                    window.AdminApp.showToast(message, type);
                }
            };

            const setSubmitting = (state) => {
                submitBtn.disabled = state;
                const btnText = submitBtn.querySelector('.btn-text');
                const btnLoader = submitBtn.querySelector('.btn-loader');
                
                if (btnText) btnText.classList.toggle('d-none', state);
                if (btnLoader) btnLoader.classList.toggle('d-none', !state);
            };

            form.addEventListener('submit', async (e) => {
                e.preventDefault();
                
                if (messageDiv) messageDiv.classList.add('d-none');

                const password = passwordInput.value;
                const confirmPassword = confirmPasswordInput.value;

                // Validation
                if (!password || !confirmPassword) {
                    showMessage('Please fill in all fields.', 'danger');
                    return;
                }

                if (password.length < 6) {
                    showMessage('Password must be at least 6 characters long.', 'danger');
                    return;
                }

                if (password !== confirmPassword) {
                    showMessage('Passwords do not match. Please try again.', 'danger');
                    return;
                }

                setSubmitting(true);

                try {
                    // Use AdminApp API base URL if available, otherwise detect it
                    let apiBaseUrl = window.AdminApp?.getApiBaseUrl();
                    
                    if (!apiBaseUrl) {
                        // Fallback: detect API base URL
                        const hostname = window.location.hostname;
                        const port = window.location.port;
                        
                        if ((hostname === 'localhost' || hostname === '127.0.0.1') && port && port !== '8000') {
                            // Development mode - use backend port 8000
                            apiBaseUrl = `http://${hostname}:8000/api/v1`;
                        } else {
                            // Production API URL
                            apiBaseUrl = 'https://api.araratdesigns.org/api/v1';
                        }
                    }
                    
                    const response = await fetch(`${apiBaseUrl}/auth/reset-password/${userId}/${token}`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ password, confirmPassword }),
                    });

                    const data = await response.json();

                    if (response.ok && data.success && !data.error) {
                        showMessage(data.message || 'Password has been reset successfully. Redirecting to login...', 'success');
                        passwordInput.value = '';
                        confirmPasswordInput.value = '';
                        
                        // Redirect to login page after 2 seconds
                        setTimeout(() => {
                            window.location.href = 'login.html';
                        }, 2000);
                    } else {
                        const errorMsg = data.message || 'Failed to reset password. The link may have expired. Please request a new one.';
                        showMessage(errorMsg, 'danger');
                        
                        // If token is invalid/expired, redirect to forgot password page after 3 seconds
                        if (errorMsg.toLowerCase().includes('expired') || errorMsg.toLowerCase().includes('invalid')) {
                            setTimeout(() => {
                                window.location.href = 'forgot-password.html';
                            }, 3000);
                        }
                    }
                } catch (error) {
                    console.error('Error resetting password:', error);
                    showMessage('Network error. Please check your connection and try again.', 'danger');
                } finally {
                    setSubmitting(false);
                }
            });
        })();
    </script>

</body>

</html>

